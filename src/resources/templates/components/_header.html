{% import 'components/_macros.html' as macros %}

<div class="grid grid-cols-1 items-center gap-4 p-4 md:grid-cols-3"
     x-data="{
    query: `{{ request.query_params.get('search', '') }}`,
    clear() {
        this.query = '';
        $nextTick(() => {
            $refs.searchInput.dispatchEvent(new Event('input', { bubbles: true }));
            $refs.searchInput.focus();
        })
    }
}">
    <h1 id="header_text" class="font-bold text-3xl text-primary justify-self-center md:justify-self-start">
        Dashboard
    </h1>
    <label class="input justify-self-center">
        <svg class="h-[1em] opacity-50" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <g stroke-linejoin="round"
               stroke-linecap="round"
               stroke-width="2.5"
               fill="none"
               stroke="currentColor">
                <circle cx="11" cy="11" r="8"></circle>
                <path d="m21 21-4.3-4.3"></path>
            </g>
        </svg>
        <input type="search" name="search" class="grow" placeholder="Search"
               x-model="query"
               x-ref="searchInput"
               @keydown.esc="clear()"
               hx-get="{{ url_for('dashboard_content') }}"
               hx-trigger="input changed delay:500ms, keyup[key=='Enter'], search"
               hx-target="#content"
               hx-vals='js:{
                   mode: new URLSearchParams(window.location.search).get("mode") || "OWN",
                   pageSize: new URLSearchParams(window.location.search).get("pageSize") || 20
               }'
        />
        <button type="button"
                @click="clear()"
                x-show="query.length > 0"
                x-transition.opacity
                class="rounded-full p-0.5 text-base-content/50 transition-colors hover:bg-secondary hover:text-secondary-content"
                aria-label="Clear search">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
                <path d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z"></path>
            </svg>
        </button>
    </label>
    <button class="btn btn-primary hidden md:flex md:justify-self-end"
            hx-get="/dashboard/partials/drawer/new"
            hx-target="#drawer-container"
            hx-swap="innerHTML">
        {{ macros.render_icon('add') }}
        New Todo
    </button>
</div>